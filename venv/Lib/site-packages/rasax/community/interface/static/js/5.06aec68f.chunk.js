(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[5],{1898:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return A}));var n=r(0),c=r(1),s=r(68),o=r(2),a=r(18),l=r(23),i=r(72),u=r(49),j=r(3),d=r(65),b=r(5),h=r(11),f=r(32),x=r(201),O=r(25);function v(e){var t=e.roles,r=e.users,s=e.total,o=e.onLoadMoreRows,a=e.onEdit,l=e.onDelete,i=c.useCallback((function(e){var t=e.dataSelected,r=e.setSelected,c=t.filter((function(e){return e.users_count&&e.users_count>0})).length;return Object(n.jsx)(b.Box,{children:Object(n.jsx)(f.a,{resource:h.d.Roles,action:h.a.Delete,yes:Object(n.jsx)(O.a,{content:c>0?"Cannot perform delete because ".concat(1===c?"the selected role still has":"".concat(c," selected roles still have")," users assigned"):"Delete",children:Object(n.jsx)(j.d,{variant:"inverse",disabled:c>0,onClick:function(){l(t),r([])},children:"Delete"})})})})}),[l]),u=c.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var c=e.rowIndex,s=e.rowData,o=t.includes(c);return Object(n.jsxs)(b.Flex,{children:[Object(n.jsx)(b.Box,{flex:"0 1 auto",children:Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:o,onChange:function(){return r(c,!o)}})})}),Object(n.jsx)(b.Box,{ml:3,flex:"1",children:Object(n.jsx)(j.y,{variant:"bodySecondary",children:s.role})})]})}}),[]),v=c.useCallback((function(){return function(e){var t=e.rowData,c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return 0===c.length?Object(n.jsx)(j.y,{variant:"bodySecondary",children:"No users currently have this role"}):c.length<3?Object(n.jsx)(j.y,{variant:"bodySecondary",children:c.map((function(e){return e.username})).join(" and ")}):Object(n.jsxs)(j.y,{variant:"bodySecondary",children:[c.slice(0,2).map((function(e){return e.username})).join(", "),Object(n.jsxs)("b",{children:[" +",c.length-2," more"]})]})}}),[r]),m=c.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return Object(n.jsxs)(b.Flex,{flexDirection:"row-reverse",mr:-1,children:[Object(n.jsx)(f.a,{resource:h.d.Roles,action:h.a.Delete,yes:0===c.length?Object(n.jsx)(O.a,{content:"Delete",children:Object(n.jsx)(j.d,{mx:1,onClick:function(){l([t])},variant:"icon",children:Object(n.jsx)(j.i,{icon:"trash-alt"})})}):Object(n.jsx)(b.Box,{mx:1,flex:"0 0 40px"})}),Object(n.jsx)(f.a,{resource:h.d.Roles,action:h.a.Update,yes:Object(n.jsx)(O.a,{content:"Edit",children:Object(n.jsx)(j.d,{mx:1,onClick:function(){a(t)},variant:"icon",children:Object(n.jsx)(j.i,{icon:"edit"})})})})]})}}),[r,a,l]);return Object(n.jsx)(x.a,{total:s,bulkActionsRenderer:i,data:t,resource:h.d.Roles,onLoadMoreRows:o,children:function(e){return[Object(n.jsx)(d.d,{cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:u(e)},"role"),Object(n.jsx)(d.d,{cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return Object(n.jsx)(j.y,{variant:"bodySecondary",children:t.description||"No description"})}},"description"),Object(n.jsx)(d.d,{cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:v()},"users"),Object(n.jsx)(d.d,{cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:m()},"role")]}})}function m(e){var t=e.roles,r=e.users,o=e.total,a=e.onLoadMoreRows,l=e.onFetchUsers,i=e.onDeleteRole,u=Object(s.g)().push,d=c.useCallback((function(e){return u("/roles/".concat(e.role))}),[u]);return c.useEffect((function(){a({search:"",offset:0,limit:0}),l({search:"",offset:0,limit:0})}),[a,l]),Object(n.jsx)(j.q,{title:"Roles",rightContent:Object(n.jsx)(j.d,{variant:"primary",large:!0,onClick:function(){return u("/roles/create")},mr:4,children:"Create new role"}),children:Object(n.jsx)(v,{roles:t,users:r,total:o,onLoadMoreRows:a,onEdit:d,onDelete:i})})}var p={onFetchUsers:u.c.request,onFetchRoles:i.d.request,onDeleteRole:i.a.request};var y=Object(a.b)((function(e){return{roles:e.roles.roles,users:e.users.users,total:e.roles.total,userRole:e.auth.role}}),p)((function(e){var t=Object(l.h)(i.d);return Object(n.jsx)(m,Object(o.a)(Object(o.a)({},e),{},{onLoadMoreRows:t}))})),w=r(24),g=r(8),C=r(642),R=r(417);function k(e){return Object(n.jsx)(j.d,Object(o.a)(Object(o.a)({variant:"icon",color:"neutral_8"},e),{},{children:Object(n.jsx)(j.i,{icon:["fas","arrow-left"]})}))}var D,F=r(71),S=r(15);function U(e,t){return[].concat(Object(S.a)(e?["read:any"]:[]),Object(S.a)(t?["create:any","update:any","delete:any"]:[]))}function B(e){var t=e.value,r=e.permission,c=e.onChange,s=t.includes("read:any"),o=t.includes("create:any");return Object(n.jsxs)(b.Flex,{py:3,children:[Object(n.jsx)(b.Box,{flex:4,width:4/6,children:Object(n.jsx)(j.y,{children:r.label})}),Object(n.jsx)(b.Box,{flex:1,width:1/6,children:!r.cannotView&&Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:s,onChange:function(){return c(U(!s,o))}})})}),Object(n.jsx)(b.Box,{flex:1,width:1/6,children:!r.cannotModify&&Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:o,onChange:function(){return c(U(s,!o))}})})})]})}function q(e){var t=e.value,r=e.onChange,c=e.permissions;return Object(n.jsxs)(b.Box,{children:[Object(n.jsxs)(b.Flex,{py:3,children:[Object(n.jsx)(b.Box,{flex:4,width:4/6,children:Object(n.jsx)(j.h,{variant:"h3",children:"Permissions"})}),Object(n.jsx)(b.Box,{flex:1,width:1/6,children:Object(n.jsx)(j.h,{variant:"h3",children:"View"})}),Object(n.jsx)(b.Box,{flex:1,width:1/6,children:Object(n.jsx)(j.h,{variant:"h3",children:"Modify"})})]}),c.map((function(e){return Object(n.jsx)(B,{permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(o.a)(Object(o.a)({},t),{},{[e.resource]:n}))}},e.resource)}))]})}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(D||(D={}));var E={role:"",description:"",is_default:!1,grants:{}};function M(e){var t=e.users,r=e.role,a=e.onSaveRole,l=e.onUpdateRole,i=e.onFetchUsers,u=e.permissions,d=Object(s.g)().push,h=c.useState(r||E),f=Object(g.a)(h,2),x=f[0],O=f[1],v=c.useState([]),m=Object(g.a)(v,2),p=m[0],y=m[1],w=c.useState(D.Users),S=Object(g.a)(w,2),U=S[0],B=S[1],M=c.useCallback((function(e){return O(Object(o.a)(Object(o.a)({},x),e))}),[x]);c.useEffect((function(){i({search:"",limit:0,offset:0})}),[i]),c.useEffect((function(){r&&O(r)}),[r]),c.useEffect((function(){y(Object.values(t).filter((function(e){return r&&-1!==e.roles.indexOf(r.role)})).map((function(e){return{label:e.username,value:e.username,data:e}})))}),[r,t,t.length]);var _=c.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return Object(n.jsx)(j.q,{scrollable:!0,title:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(k,{onClick:function(){return d("/roles")}})," ",r?"Edit":"Create new"," ","Role"]}),rightContent:Object(n.jsxs)(b.Flex,{mr:-2,pr:4,flexDirection:"row-reverse",children:[Object(n.jsxs)(j.d,{variant:"primary",onClick:function(){var e=p.map((function(e){return e.data})),t=function(){d("/roles")},n=Object(o.a)(Object(o.a)({},x),{},{is_default:!!x.is_default});r?l({currentId:r.role,role:n,users:e,onSaved:t}):a({role:n,users:e,onSaved:t})},large:!0,mr:2,children:[r?"Save":"Create"," role"]}),Object(n.jsx)(j.d,{variant:"secondary",onClick:function(){return d("/roles")},large:!0,mr:2,children:r?"Cancel":"Discard"})]}),children:Object(n.jsxs)(b.Box,{width:2/3,m:"0 auto",children:[Object(n.jsxs)(j.e,{sx:{borderRadius:"large"},p:6,mb:6,children:[Object(n.jsx)(j.h,{variant:"h2",mb:4,children:"Basic Details"}),Object(n.jsx)(b.Box,{mb:4,width:"100%",children:Object(n.jsx)(F.a,{text:"Name",children:Object(n.jsx)(j.k,{value:x.role,onChangeValue:function(e){return M({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0})})}),Object(n.jsx)(b.Box,{mb:4,width:"100%",children:Object(n.jsx)(F.a,{text:"Description",children:Object(n.jsx)(j.k,{value:x.description||"",onChangeValue:function(e){return M({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"})})}),Object(n.jsxs)(b.Flex,{as:"label",alignItems:"center",children:[Object(n.jsx)(j.f,{checked:x.is_default||!1,onChange:function(e){return M({is_default:!x.is_default})},mr:2}),Object(n.jsx)(j.y,{children:"Set as default roles"})]})]}),Object(n.jsxs)(j.e,{sx:{borderRadius:"large"},p:6,children:[Object(n.jsxs)(C.a,{justifyContent:"flex-start",ml:-3,mb:4,children:[Object(n.jsx)(R.a,{variant:"h2",active:U===D.Permissions,onClick:function(){return B(D.Permissions)},children:"Add Permissions"}),Object(n.jsx)(R.a,{variant:"h2",active:U===D.Users,onClick:function(){return B(D.Users)},children:"Add Users"})]}),U===D.Permissions&&Object(n.jsx)(q,{permissions:u,value:x.grants,onChange:function(e){return M({grants:e})}}),U===D.Users&&Object(n.jsx)(F.a,{text:"Add users to this Role",children:Object(n.jsx)(j.o,{placeholder:"Search users...",items:_,onChange:function(e){y(Array.isArray(e)?e:[])},value:p})})]})]})})}var _={onSaveRole:i.f.request,onUpdateRole:i.g.request,onFetchUsers:u.c.request,onFetchRole:i.b.request,onFetchRoleUsers:i.c.request};var G=Object(a.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles}}),_)((function(e){var t=e.roles,r=e.onFetchRoleUsers,a=e.onFetchRole,l=Object(w.a)(e,["roles","onFetchRoleUsers","onFetchRole"]),i=Object(s.i)().params.roleName;c.useEffect((function(){i&&(a(i),r(i))}),[a,r,i]);var u=c.useMemo((function(){if(i)return Object.values(t).find((function(e){return e.role===i}))}),[i,t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(M,Object(o.a)({role:u},l))})}));function A(e){var t=Object(l.l)();c.useEffect((function(){t("view:roles:loaded")}),[t]);var r=Object(s.i)();return Object(n.jsxs)(s.e,{children:[Object(n.jsx)(s.c,{exact:!0,path:r.path,component:y}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/create"),component:G}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/:roleName"),component:G})]})}}}]);